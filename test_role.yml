---
    - name: gtm checks
      hosts: dev_f5
      connection: local
      gather_facts: true
    
      vars:
        pool_member_prefix: https_virtual
        operation: enable

      tasks:
      - name:  F5 REST Login
        include_tasks:
          file: f5_rest_login.yml

      - name: Pull out resource variables from service definition
        set_fact:
          service_resources: "{{ next_definition }}"
        loop: "{{ dev_resource_definition }}"
        loop_control:
          loop_var: next_definition
        when: next_definition.name == "gtm_resource_group"
        tags: audit
     
      - name: Check GSLB pool using REST
        include_role:
          name: f5_gslb_role
        vars:
          partition: "{{ service_resources.partition }}"
          gslb_pool_name: "{{ next_gslb_pool_name }}"
        loop: "{{ service_resources.gslb_pool_name }}"
        loop_control:
          loop_var: next_gslb_pool_name
        tags: audit